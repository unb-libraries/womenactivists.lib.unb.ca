language: php

services:
  - docker

php:
  - '7.2'

git:
  depth: 1

before_install:
  - curl -Ls https://raw.githubusercontent.com/unb-libraries/dockworker/3.x/scripts/travis/init.sh | bash
  - composer install

script:
  - set -e
  - vendor/bin/dockworker local:build-test
  - vendor/unb-libraries/dockworker/scripts/kubectl/init.sh
  - vendor/bin/dockworker image:deploy $TRAVIS_BRANCH
  - vendor/bin/dockworker deployment:logs:check $TRAVIS_BRANCH
  - vendor/unb-libraries/dockworker/scripts/travis/notifyNewRelicDeployment.sh

notifications:
  slack:
    rooms:
      secure: Ii0qpc5B53gBVqNX9ck9PLPmCyXRU6TlnsGj3pVxydjpDQAS6pei2+/irkzIEtezfCdhAXcSyIEOH035EhNhInF3Ir44jwkKEKHig93ERQdr1KIyzdTkTohJ4PHG/o9GjavZPM6QCUDgp51CAXsJ+dE9aHBTTtqRf9x8nTdknlNqhsrQ3dpitFygweE71PpPSs/k1jsAaE2Bpu52SFgQ4fG9hVTe7nJrUt3o+4KSo+A2165E4V6fuo7qxBOfkw2RKwEUm/Af2FGPE3S/l14UDeImn+73DuLBW9pHG4CwYdGvdBEm+k8KAnzgj9N5NqkyHetZaKC4Y0GhrpQh3TIwO9EgjFGzZLg8bDtkKRtAM5puMBtzb5Elv2Fek/ZlD8jAS1+6L0+b2ygzXtgzvBISfiP305jfayfAb9k2c3kFVD+vpT+Fl2uAavnZJiKN3cq0cXx8Zpxua2qe8vCMtJLw3DmE6ZBqnyi/xQErxpnFmWJ4n9rZ/FIUCJcJ/Pe/dSKdZzJMwOSJmpHivQBrVHcJziW5H2SWk/nu8Y07QDby6BzKe+FZb3sn4lvsCgEa9spB5QolqxsJpABWKpFKF4PXYqtK8r+k9KBsmcmiWQftGWfug7rmO2u6YgYOAJRFmDgWUPaLwuJKBa9c5xMkdT5RHsLIGW9lqs+1z/oXEGHFMkM=
    on_start: always
    on_success: always
